<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <style type="text/css">
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
      }
      #content {
        background: #00FF65;
      }
      #content img.layer {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }
      #content #character {
        z-index: 1000;
      }
    </style>

  </head>

  <body onload="loaded()">

    <div id="content">
      <!--img class="layer" src="img/fordje_0003_Calque-0.png" alt="Calque-0" />
      <img class="layer" src="img/fordje_0002_Calque-3.png" alt="Calque-3" />
      <img class="layer" src="img/fordje_0001_Calque-1.png" alt="Calque-1" />
      <img class="layer" src="img/fordje_0000_Calque-4.png" alt="Calque-4" />
      <img class="layer" id="character" src="img/fordje_0000_Calque-5.png" alt="Calque-5" /-->
      <img class="layer static" src="img/fordje_0001_background.png" alt="Background" />
      <img id="character" class="layer character" src="img/fordje_0000_character.png" alt="Character" />
    </div>

    <script src="js/lib/jquery-1.7.2.min.js"></script>
    <script src="js/rat/Rat.js"></script>
    <script src="js/rat/container/Viewport.js"></script>
    <script src="js/rat/core/lang/Object.js"></script>
    <script src="js/rat/core/dom/class/Base.js"></script>
    <script src="js/rat/core/dom/class/Class.js"></script>
    <script src="js/rat/core/dom/class/ClassManager.js"></script>
    <script>
      function loaded() {
        Rat.define("Test", { name: "toto" });
      }
      $(function() {
        console.log("jquery loaded");
        Character = {
          originalPosition: {
            x: 920,
            y: 620
          },
          originalPivotPoint: {
            x: 93,
            y: 277
          },
          pivotPoint: { },
          originalSize: { },
          init: function() {
            this.originalSize = {
              x: +$("#character").width(),
              y: +$("#character").height()
            };
            this.pivotPoint = this.originalPivotPoint;
          }
        };
        Layer = {
          originalDimensions: {
            x: 1800,
            y: 1024
          },
          scaledRatio: { },
          scale: {
            minCharRatio: 0.5,
            minY: 650
          },
          init: function() {
            this.scaledRatio.x = window.innerWidth / this.originalDimensions.x;
            this.scaledRatio.y = window.innerHeight / this.originalDimensions.y;
            $("#content img.static").css({
              width: window.innerWidth,
              height: window.innerHeight
            });
            $("#character").css({
              width: Math.round(Character.originalSize.x * this.scaledRatio.x),
              height: Math.round(Character.originalSize.y * this.scaledRatio.y),
              top: Math.round(Character.originalPosition.y * this.scaledRatio.y) + "px",
              left: Math.round(Character.originalPosition.x * this.scaledRatio.x) + "px"
            });
            //$("#character").css({
            //  width: 
          }
        };
        Character.init();
        Layer.init();
        console.log(window.innerWidth + "x" + window.innerHeight);
        $("#content").click(function(e) {
          var $character = $("#character"),
              oldPosition = { x: $character.offset().left, y: $character.offset().top },
              projPage = {
                x: Math.round(e.pageX / Layer.scaledRatio.x),
                y: Math.round(e.pageY / Layer.scaledRatio.y)
              };
              offset = {
                x: Math.round(Character.originalPivotPoint.x * Layer.scaledRatio.x),
                y: Math.round(Character.originalPivotPoint.y * Layer.scaledRatio.y)
              },
              newPosition = {
                x: e.pageX - offset.x,
                y: e.pageY - offset.y
              },
              scale = Layer.scale.minCharRatio;

          console.log("Proj Page: " + projPage.x + "x" + projPage.y);
          console.log("Page: " + e.pageX + "x" + e.pageY);
          console.log("Position: " + newPosition.x + "x" + newPosition.y);

          $character.animate({
            top: newPosition.y + "px",
            left: newPosition.x + "px"
            }, 1000);
        });
      });
    </script>

  </body>
</html>
